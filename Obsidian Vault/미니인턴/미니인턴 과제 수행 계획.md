# 미니인턴 과제 수행 계획

## 📋 과제 개요

**목적**: Node.js + Express + TypeScript로 M클래스 신청 시스템 백엔드 API 서버 구축  
**핵심 평가 요소**: 인증/인가, CRUD 구현, 데이터 정합성 유지, 예외 처리, 동시성 제어

---

## 🎯 핵심 목표

### 필수 구현 기능
- [ ] 유저 및 M클래스 CRUD
- [ ] JWT 기반 인증 시스템
- [ ] 권한 기반 접근 제어 (관리자/일반 사용자)
- [ ] 테스트 코드 작성

### 선택 구현 기능 (우선순위별)
1. **동시성 처리** ⭐⭐⭐ (핵심 차별화 요소)
   - 최대 100명 클래스에 200명 동시 신청 시 DB 레벨에서 100명만 처리
2. **Docker 설정** ⭐⭐
3. **이메일 알림** ⭐
4. **특정 유저 접근 제한** ⭐

---

## 🏗️ 기술 스택 & 아키텍처

### 기술 스택
```yaml
Runtime: Node.js 18+
Framework: Express.js
Language: TypeScript
Database: PostgreSQL (구현 완료)
Authentication: JWT
Testing: Jest + Supertest
ORM: Prisma (추천) / TypeORM
Validation: Joi / Zod
```

### 데이터베이스 설계
```mermaid
erDiagram
    USER ||--o{ APPLICATION : has
    CLASS ||--o{ APPLICATION : receives
    USER ||--o{ CLASS : hosts

    USER {
        string id PK
        string email
        string password
        boolean isAdmin
        datetime createdAt
        datetime updatedAt
    }

    CLASS {
        string id PK
        string title
        string description
        int maxParticipants
        datetime startAt
        datetime endAt
        string hostId FK
        datetime createdAt
        datetime updatedAt
    }

    APPLICATION {
        string id PK
        string userId FK
        string classId FK
        datetime createdAt
    }
```

---

## 📝 API 설계

### 사용자 관련 API
| 기능 | 메서드 | 경로 | 인증 | 요청 | 응답 |
|------|--------|------|------|------|------|
| 회원가입 | POST | `/api/users/signup` | ❌ | email, password | userId, message |
| 로그인 | POST | `/api/users/login` | ❌ | email, password | accessToken |
| 내 신청 내역 | GET | `/api/users/applications` | ✅ | - | 신청 목록 |

### M클래스 관련 API
| 기능 | 메서드 | 경로 | 인증 | 요청 | 응답 |
|------|--------|------|------|------|------|
| 클래스 생성 | POST | `/api/mclasses` | ✅ (관리자) | title, description, maxParticipants, startAt, endAt | classId |
| 클래스 목록 | GET | `/api/mclasses` | ❌ | - | 클래스 목록 |
| 클래스 상세 | GET | `/api/mclasses/:id` | ❌ | - | 클래스 상세 정보 |
| 클래스 삭제 | DELETE | `/api/mclasses/:id` | ✅ (관리자) | - | 삭제 성공 여부 |
| 클래스 신청 | POST | `/api/mclasses/:id/apply` | ✅ | - | 신청 성공 여부 |

---

## 🚀 개발 단계별 계획

### Phase 1: 프로젝트 기반 설정 (1일)
- [ ] Node.js + Express + TypeScript 환경 구축
- [ ] 프로젝트 구조 설계
- [ ] 데이터베이스 연결 설정
- [ ] 기본 미들웨어 설정 (CORS, body-parser, error handler)

### Phase 2: 데이터베이스 & 모델 설계 (0.5일)
- [ ] ERD 최종 확정
- [ ] 데이터베이스 스키마 작성
- [ ] ORM 모델 정의
- [ ] 마이그레이션 파일 작성

### Phase 3: 인증 시스템 구현 (1일)
- [ ] JWT 토큰 생성/검증 유틸리티
- [ ] 비밀번호 해싱 (bcrypt)
- [ ] 인증 미들웨어 구현
- [ ] 회원가입/로그인 API

### Phase 4: 사용자 API 구현 (0.5일)
- [ ] 사용자 CRUD 기본 기능
- [ ] 내 신청 내역 조회 API
- [ ] 입력값 검증 로직

### Phase 5: M클래스 API 구현 (1일)
- [ ] M클래스 CRUD API
- [ ] 권한 기반 접근 제어
- [ ] 데이터 검증 및 에러 처리

### Phase 6: 신청 시스템 구현 (1.5일)
- [ ] 기본 신청 로직 구현
- [ ] 중복 신청 방지
- [ ] 마감 시간 체크
- [ ] 정원 초과 방지
- [ ] **동시성 처리** (DB 트랜잭션 + 락)

### Phase 7: 테스트 코드 작성 (1일)
- [ ] 단위 테스트 (각 함수별)
- [ ] 통합 테스트 (API 엔드포인트별)
- [ ] 동시성 테스트 (중요!)
- [ ] 테스트 커버리지 확인

### Phase 8: 문서화 & 마무리 (0.5일)
- [ ] API 명세서 작성
- [ ] README.md 작성
- [ ] 설계 의도 및 트러블슈팅 문서
- [ ] 코드 정리 및 최적화

---

## ⚡ 핵심 기술적 도전과제

### 1. 동시성 처리 전략
```typescript
// 전략 1: 데이터베이스 레벨 제약조건
// UNIQUE 제약조건으로 중복 신청 방지
// CHECK 제약조건으로 정원 초과 방지

// 전략 2: 트랜잭션 + 락
// 비관적 락 또는 낙관적 락 활용
// 데드락 방지 로직 구현

// 전략 3: 큐 시스템 (고급)
// Redis + Bull Queue로 신청 요청 처리
```

### 2. 데이터 정합성 보장
- 중복 신청 방지: `UNIQUE(userId, classId)`
- 정원 초과 방지: 트랜잭션 내 COUNT 검증
- 마감시간 검증: 애플리케이션 레벨 + DB 레벨 이중 체크

### 3. 보안 고려사항
- 비밀번호 해싱: bcrypt 사용
- JWT 토큰: 적절한 만료시간 설정
- 입력값 검증: SQL Injection, XSS 방지
- Rate Limiting: 무차별 요청 방지

---

## 🧪 테스트 전략

### 테스트 카테고리
1. **단위 테스트**: 개별 함수/메서드
2. **통합 테스트**: API 엔드포인트
3. **동시성 테스트**: 다중 요청 처리
4. **보안 테스트**: 인증/인가 검증

### 핵심 테스트 시나리오
```javascript
// 동시성 테스트 예시
test('100명 정원 클래스에 200명 동시 신청 시 100명만 성공', async () => {
  const requests = Array(200).fill().map(() => 
    request(app).post('/api/mclasses/1/apply').set('Authorization', token)
  );
  
  const responses = await Promise.allSettled(requests);
  const successCount = responses.filter(r => r.status === 201).length;
  
  expect(successCount).toBe(100);
});
```

---

## 📦 프로젝트 구조

```
miniintern-backend/
├── src/
│   ├── controllers/     # API 컨트롤러
│   ├── middlewares/     # 미들웨어 (인증, 권한, 에러처리)
│   ├── models/          # 데이터베이스 모델
│   ├── routes/          # 라우터 정의
│   ├── services/        # 비즈니스 로직
│   ├── utils/           # 유틸리티 함수
│   ├── types/           # TypeScript 타입 정의
│   └── app.ts           # Express 앱 설정
├── tests/               # 테스트 파일
├── prisma/              # 데이터베이스 스키마
├── docs/                # API 문서
└── README.md
```

---

## 🎖️ 성공 기준

### 필수 달성 목표
- [ ] 모든 필수 API 정상 작동
- [ ] 테스트 커버리지 80% 이상
- [ ] 동시성 처리 정상 작동
- [ ] 완성도 높은 문서화

### 우수 평가 요소
- 동시성 처리의 우아한 해결
- 체계적인 에러 처리
- 확장 가능한 아키텍처 설계
- 실무진의 코드 리뷰 관점 반영

---

## 📋 일정 관리

**총 개발 기간**: 6일  
**일일 작업량**: 6-8시간  

| 일차 | 작업 내용 | 목표 |
|------|-----------|------|
| 1일 | Phase 1-2 | 기반 설정 완료 |
| 2일 | Phase 3 | 인증 시스템 완료 |
| 3일 | Phase 4-5 | 기본 API 완료 |
| 4일 | Phase 6 | 신청 시스템 완료 |
| 5일 | Phase 7 | 테스트 완료 |
| 6일 | Phase 8 | 문서화 완료 |

---

## 💡 추가 고려사항

- **로깅**: Winston으로 체계적 로그 관리
- **모니터링**: 성능 메트릭 수집
- **배포**: Docker + GitHub Actions CI/CD
- **확장성**: 마이크로서비스 전환 가능한 구조